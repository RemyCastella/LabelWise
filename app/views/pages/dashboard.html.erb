<div class="container d-flex flex-column align-items-center">
  <div class="mt-3">
    <div>
      <div class="btn-group d-flex justify-content-center" data-controller="tab-switch" role="group" aria-label="Basic radio toggle button group">
        <%= link_to "Today", root_path(tab: "today"), class: "#{"active" if @tab == "today" || @tab.nil? } btn btn-outline-primary", data: { action: "click->tabSwitch#show", tab_switcher_target: "tab" } %>
        <%= link_to "Yesterday", root_path(tab: "yesterday"), class: "#{"active" if @tab == "yesterday"} btn btn-outline-primary" , data: { action: "click->tabSwitch#show", tab_switcher_target: "tab" } %>
        <%= link_to "This week", root_path(tab: "this_week"), class: "#{"active" if @tab == "this_week"} btn btn-outline-primary", data: { action: "click->tabSwitch#show", tab_switcher_target: "tab" } %>
      </div>
      <div id="section1" data-tab-switcher-target="section">
        <!-- Your stats content here -->
        <div class="chart-container pt-3" style="position: relative;">
          <% if @tab == "this_week" %>
            <%= column_chart [
                { name: 'Calories', data: @daily_nutrition[:calories] },
                # { name: 'Protein', data: @daily_nutrition[:protein] },
                # { name: 'Fat', data: @daily_nutrition[:fat] },
                # { name: 'Carbohydrates', data: @daily_nutrition[:carbohydrates] },

              ],
              labels: @week_days.map { |day| day.strftime("%b %d") },
              stacked: true,
              colors: [ '#059033', '#17a2b8', '#5055aa', '#c46210'],
              chart_type: "column",
              title: "Calories",
              legend: {
                display: false
              },
              library: {
                scales: {
                  x: {
                    ticks: {
                      autoSkip: true,
                      maxRotation: 45,
                      minRotation: 45
                    }
                  },
                  y: {
                    beginAtZero: true,
                    max: @user.calories,
                    ticks: {
                      stepSize: @user.calories / 5,
                      precision: 0,
                      count: 6,
                    }
                  }
                }
              }
            %>
            <div class="macro-group">
            <div class='d-flex justify-content-between'>
              <p class="fs-6 fw-semibold">Protein</p>
              <p class="fs-6"><%= @total_nutrition[:protein] %>g / <%= @user.protein * 7 %>g</p>
            </div>
            <div class="progress">
              <div class="progress-bar progress-bar-striped progress-bar-animated bg-info" role="progressbar" style="width: <%= @total_nutrition[:protein] %>%" aria-valuenow="<%= @total_nutrition[:protein] %>" aria-valuemin="0" aria-valuemax="<%= @user.protein %>"></div>
            </div>
          </div>
          <div class="macro-group">
            <div class='d-flex justify-content-between'>
              <p class="fs-6 fw-semibold">Fat</p>
              <p class="fs-6"><%= @total_nutrition[:fat] %>g / <%= @user.fat * 7 %>g</p>
            </div>
            <div class="progress">
              <div class="progress-bar progress-bar-striped progress-bar-animated bg-danger" role="progressbar" style="width: <%= @total_nutrition[:fat] %>%" aria-valuenow="<%= @total_nutrition[:fat] %>" aria-valuemin="0" aria-valuemax="<%= @user.fat %>"></div>
            </div>
          </div>
          <div class="macro-group">
            <div class='d-flex justify-content-between'>
              <p class="fs-6 fw-semibold">Carbs</p>
              <p class="fs-6"><%= @total_nutrition[:carbohydrates] %>g / <%= @user.carbohydrates * 7 %>g</p>
            </div>
            <div class="progress">
              <div class="progress-bar progress-bar-striped progress-bar-animated bg-warning" role="progressbar" style="width: <%= @total_nutrition[:carbohydrates] %>%" aria-valuenow="<%= @total_nutrition[:carbohydrates] %>" aria-valuemin="0" aria-valuemax="<%= @user.carbohydrates %>"></div>
            </div>
          </div>

          <% else %>
            <%= pie_chart (@total_nutrition),
              donut: true,
              colors: ['#17a2b8', '#5055aa', '#c46210'],
              library: {
                cutout: '85%',
                segmentShowStroke: false,
                plugins: {
                  legend: {
                    display: false,
                    position: 'right',
                    labels: {
                      font: {
                        size: 14
                      },
                      color: '#333'
                    }
                  }
                }
              }
            %>
            <div class="chart-text fw-semibold d-flex flex-column" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 18px; color: black;">
              <div class="fs-1"><%= @total_cal %> kcal</div>
              <div class="text-secondary align-self-center">/<%= @user.calories || 2000 %> kcal</div>
            </div>
          </div>
          <div class="macro-group">
            <div class='d-flex justify-content-between'>
              <p class="fs-6 fw-semibold">Protein</p>
              <p class="fs-6"><%= @total_nutrition[:protein] %>g / <%= @user.protein %>g</p>
            </div>
            <div class="progress">
              <div class="progress-bar progress-bar-striped progress-bar-animated bg-info" role="progressbar" style="width: <%= @total_nutrition[:protein] %>%" aria-valuenow="<%= @total_nutrition[:protein] %>" aria-valuemin="0" aria-valuemax="<%= @user.protein %>"></div>
            </div>
          </div>
          <div class="macro-group">
            <div class='d-flex justify-content-between'>
              <p class="fs-6 fw-semibold">Fat</p>
              <p class="fs-6"><%= @total_nutrition[:fat] %>g / <%= @user.fat %>g</p>
            </div>
            <div class="progress">
              <div class="progress-bar progress-bar-striped progress-bar-animated bg-danger" role="progressbar" style="width: <%= @total_nutrition[:fat] %>%" aria-valuenow="<%= @total_nutrition[:fat] %>" aria-valuemin="0" aria-valuemax="<%= @user.fat %>"></div>
            </div>
          </div>
          <div class="macro-group">
            <div class='d-flex justify-content-between'>
              <p class="fs-6 fw-semibold">Carbs</p>
              <p class="fs-6"><%= @total_nutrition[:carbohydrates] %>g / <%= @user.carbohydrates %>g</p>
            </div>
            <div class="progress">
              <div class="progress-bar progress-bar-striped progress-bar-animated bg-warning" role="progressbar" style="width: <%= @total_nutrition[:carbohydrates] %>%" aria-valuenow="<%= @total_nutrition[:carbohydrates] %>" aria-valuemin="0" aria-valuemax="<%= @user.carbohydrates %>"></div>
            </div>
          </div>
          <div class="card-product mt-3">
            <img src="https://raw.githubusercontent.com/lewagon/fullstack-images/master/uikit/skateboard.jpg" />
            <div class="card-product-infos">
              <h2>Product name</h2>
              <p>Product description with <strong>relevant info</strong> only.</p>
            </div>
          </div>
        </div>
        <div id="section2" data-tab-switcher-target="section" hidden>
          <h2>Other Information</h2>
          <p>Details about something else here.</p>
        </div>
        <div id="section3" data-tab-switcher-target="section" hidden>
          <h2>Another Tab Content</h2>
          <p>More content for this tab.</p>
        </div>
      <% end %>
    </div>
  </div>
</div>
