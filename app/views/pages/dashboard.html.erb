<!-- Container for Stats Section -->
<div class="container d-flex flex-column align-items-center">
  <h1 class="text-center">Your stats</h1>

  <!-- Tab Buttons (Mobile Friendly) -->
  <div class="mt-3 w-100">
    <div class="btn-group d-flex flex-wrap w-100" data-controller="tab-switch" role="group">
      <%= link_to "Today", root_path(tab: "today"), class: "btn btn-outline-primary flex-fill text-center #{'active' if @tab == 'today' || @tab.nil?}", data: { action: "click->tabSwitch#show", tab_switcher_target: "tab" } %>
      <%= link_to "Yesterday", root_path(tab: "yesterday"), class: "btn btn-outline-primary flex-fill text-center #{'active' if @tab == 'yesterday'}", data: { action: "click->tabSwitch#show", tab_switcher_target: "tab" } %>
      <%= link_to "This week", root_path(tab: "this_week"), class: "btn btn-outline-primary flex-fill text-center #{'active' if @tab == 'this_week'}", data: { action: "click->tabSwitch#show", tab_switcher_target: "tab" } %>
    </div>
  </div>

  <!-- Stats Content Section -->
  <div id="section1" data-tab-switcher-target="section">
    <div class="position-relative pt-4 d-flex justify-content-center" style="max-width: 100%; height: auto;">
      <%= pie_chart(@total_nutrition, donut: true, colors: ['#17a2b8', '#5055aa', '#c46210'], library: { cutout: '85%' }) %>
      <div class="chart-text fw-semibold text-center position-absolute" style="top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 18px;">
        <div class="fs-1"><%= @total_cal %> kcal</div>
        <div class="text-secondary">/<%= @user.calories || 2000 %> kcal</div>
      </div>
    </div>

    <!-- Macro Nutrient Progress Bars -->
    <% { protein: "bg-info", fat: "bg-danger", carbohydrates: "bg-warning" }.each do |macro, color| %>
      <div class="macro-group w-100 px-2">
        <div class="d-flex justify-content-between">
          <p class="fs-6 fw-semibold"><%= macro.capitalize %></p>
          <p class="fs-6"><%= @total_nutrition[macro] %>g / <%= @user[macro] %>g</p>
        </div>
        <div class="progress w-100">
          <div class="progress-bar progress-bar-striped progress-bar-animated <%= color %>" role="progressbar"
               style="width: <%= [(@total_nutrition[macro].to_f / @user[macro].to_f) * 100, 100].min %>%;"
               aria-valuenow="<%= @total_nutrition[macro] %>" aria-valuemin="0" aria-valuemax="<%= @user[macro] %>">
          </div>
        </div>
      </div>
    <% end %>

    <!-- User Scans Section (Mobile Optimized) -->
    <div class="container mt-4">
      <div class="row justify-content-center">
        <% @user.scans.uniq(&:food_id).each do |scan| %>
          <div class="col-12 col-md-10 col-lg-8 mb-3">
            <div class="card shadow-lg border-0 rounded-4 d-flex flex-row align-items-center p-2"
                 style="display: flex; flex-wrap: nowrap; align-items: center; height: 90px;">

              <!-- Image Section -->
              <div class="position-relative" style="flex: 0 0 70px;">
                <%= cl_image_tag scan.photo.key,
                  alt: "Food Image",
                  class: "rounded-4",
                  style: "width: 70px; height: 70px; object-fit: cover;" %>
              </div>

              <!-- Text Section -->
              <div class="card-body d-flex flex-column justify-content-center ms-2"
                   style="flex: 1; min-width: 0; padding: 6px;">
                <h6 class="fw-bold mb-1 text-truncate"><%= scan.food.name %></h6>
                <p class="text-muted small mb-1">üî• <strong><%= scan.food.calories %></strong> kcal</p>
                <p class="text-muted small">ü•© <%= scan.food.protein %>g | üçû <%= scan.food.carbohydrates %>g | ü•ë <%= scan.food.fat %>g</p>
              </div>

              <!-- Button Section -->
              <div class="ms-auto me-3" style="flex-shrink: 0;">
                <a href="scan.food" class="btn btn-outline-primary btn-sm rounded-pill fw-bold">
                  View
                </a>
              </div>

            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
